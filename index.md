# Malware Deobfuscate

Kudos to senpai ayed, mashta ding, afif and txqi to help me through the questions

## In Memory Attack

We were given a malware file with .jsp extension but it contains some obfuscated powershell code.

![image](https://user-images.githubusercontent.com/32232422/120579053-6b85db00-c459-11eb-9b99-760f5e46fe1e.png)

Now we can throw the variable to powershell and see what it can interpret for us. Noted: Do not include IE command because it will execute the malware. IE stands for Invoke-Expression.

![image](https://user-images.githubusercontent.com/32232422/120579308-e0591500-c459-11eb-97cb-9959d5dec9e1.png)

Then you can copy the function after powershell interpret it for us. To make it easier, you can decode the variable and save it into file. There are 2 commands that we can use which is `> <filename>` and pipe `| Out-File <filename>`. If the obfuscated code has semicolon at the end, make sure to remove it otherwise it will not read anything after it(just my assumption lol).

![image](https://user-images.githubusercontent.com/32232422/120580219-60cc4580-c45b-11eb-8e89-f4c03b229f80.png)

or

![image](https://user-images.githubusercontent.com/32232422/120580480-dcc68d80-c45b-11eb-933f-c3209792ca6c.png)

The output will be save in a file and it is more readable compared to the previous one.

![image](https://user-images.githubusercontent.com/32232422/120581236-09c77000-c45d-11eb-8df8-e56f75e9206d.png)

As we can see here, everything is complicated to understand but we found something strange on some keyword. Not that there some keyword that has been reverse such as `rAHc` which we known as `char`, `locotorp` as `protocol` and `EcalPer` as `replace`. This means we have to reverse the code using cyberchef. Just throw the obfuscated code and select reverse to bake.

![image](https://user-images.githubusercontent.com/32232422/120583850-85c3b700-c461-11eb-935d-54744e11b7e8.png)

Now it more readable, but it seems like we have certain keywords that still in reverse. If we look closely at the bottom of the code, we found that it will replace certain keyword with certain characters. You can learn about replace() [here](https://adamtheautomator.com/powershell-replace/).

![image](https://user-images.githubusercontent.com/32232422/120584350-69744a00-c462-11eb-8879-cbb6a450bfc7.png)

How we gonna translate the hex into strings? Well, there are plenty of techniques that we can use but the most fastest way is just execute it on powershell. Before that, we found some repeated keyword such as '+', and it does affect on the code if we remove it. It you're using vscode like I am, you can search the keyword that you want to remove by pressing CTRL+f and type keyword, then press ALT+ENTER to highlight all keywords and delete. Then Im gonna copy replace() code to other place so I am not confusing in the future(you will get it soon) and it looks like this.

![image](https://user-images.githubusercontent.com/32232422/120586218-b3126400-c465-11eb-8cac-8dc6692cabe6.png)

This is one way to decode the hex.

![image](https://user-images.githubusercontent.com/32232422/120586470-303dd900-c466-11eb-962b-c4c72e5b4cb8.png)

After decoding the hex character, this is the result.

- Kv1 = '9N0'
- fEH = '
- 'fG9' = |
- xJy = 'h83'
- ZoW = \`
- pgO = "
- qfh = '
- 9N0 = $
- h83 = \

For now, we just have to replace all the keywords andd here is the results.

![image](https://user-images.githubusercontent.com/32232422/120588478-d63f1280-c469-11eb-8f53-0f2c7ac7dd6e.png)













You can use the [editor on GitHub](https://github.com/nightfury99/Malware-Deobfuscate/edit/gh-pages/index.md) to maintain and preview the content for your website in Markdown files.












Whenever you commit to this repository, GitHub Pages will run [Jekyll](https://jekyllrb.com/) to rebuild the pages in your site, from the content in your Markdown files.

### Markdown

Markdown is a lightweight and easy-to-use syntax for styling your writing. It includes conventions for

```markdown
Syntax highlighted code block

# Header 1
## Header 2
### Header 3

- Bulleted
- List

1. Numbered
2. List

**Bold** and _Italic_ and `Code` text

[Link](url) and ![Image](src)
```

For more details see [GitHub Flavored Markdown](https://guides.github.com/features/mastering-markdown/).

### Jekyll Themes

Your Pages site will use the layout and styles from the Jekyll theme you have selected in your [repository settings](https://github.com/nightfury99/Malware-Deobfuscate/settings/pages). The name of this theme is saved in the Jekyll `_config.yml` configuration file.

### Support or Contact

Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and weâ€™ll help you sort it out.
